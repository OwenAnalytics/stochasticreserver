<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example Stochastic Reserving â€¢ stochasticreserver</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example Stochastic Reserving">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stochasticreserver</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/manual.html">Stochastic Reserving Manual</a>
    </li>
    <li>
      <a href="../articles/stochastic_reserving.html">Example Stochastic Reserving</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Example Stochastic Reserving</h1>
                        <h4 class="author">Roger Hayne</h4>
            
            <h4 class="date">9/6/2019</h4>
      
      
      <div class="hidden name"><code>stochastic_reserving.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mvtnorm)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#library(MASS)</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(abind)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(stochasticreserver)</a></code></pre></div>
<div id="initialize-triangle" class="section level2">
<h2 class="hasAnchor">
<a href="#initialize-triangle" class="anchor"></a>Initialize Triangle</h2>
<p>Input (B0) is a development array of cumulative averages with a the exposures (claims) used in the denominator appended as the last column. Assumption is for the same development increments as exposure increments and that all development lags with no development have # been removed. Data elements that are not available are indicated as such. This should work (but not tested for) just about any subset of an upper triangular data matrix.<br>
Another requirement of this code is that the matrix contain no columns that are all zero.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">B0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">670.25868</span>,<span class="fl">1480.24821</span>,<span class="fl">1938.53579</span>,<span class="fl">2466.25469</span>,<span class="fl">2837.84888</span>,<span class="fl">3003.52391</span>,</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">            <span class="fl">3055.38674</span>,<span class="fl">3132.93838</span>,<span class="fl">3141.18638</span>,<span class="fl">3159.72524</span>,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">            <span class="fl">767.98833</span>,<span class="fl">1592.50266</span>,<span class="fl">2463.79447</span>,<span class="fl">3019.71976</span>,<span class="fl">3374.72689</span>,<span class="fl">3553.61387</span>,<span class="fl">3602.27898</span>,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">            <span class="fl">3627.28386</span>,<span class="fl">3645.5656</span>,<span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">            <span class="fl">740.57952</span>,<span class="fl">1615.79681</span>,<span class="fl">2345.85028</span>,<span class="fl">2910.52511</span>,<span class="fl">3201.5226</span>,<span class="fl">3417.71335</span>,<span class="fl">3506.58672</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">            <span class="fl">3529.00243</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">            <span class="fl">862.11956</span>,<span class="fl">1754.90405</span>,<span class="fl">2534.77727</span>,<span class="fl">3270.85361</span>,<span class="fl">3739.88962</span>,<span class="fl">4003.00219</span>,<span class="fl">4125.30694</span>,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">            <span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">            <span class="fl">840.94172</span>,<span class="fl">1859.02531</span>,<span class="fl">2804.54535</span>,<span class="fl">3445.34665</span>,<span class="fl">3950.47098</span>,<span class="fl">4185.95298</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">            <span class="fl">848.00496</span>,<span class="fl">2052.922</span>,<span class="fl">3076.13789</span>,<span class="fl">3861.03111</span>,<span class="fl">4351.57694</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">            <span class="fl">901.77403</span>,<span class="fl">1927.88718</span>,<span class="fl">3003.58919</span>,<span class="fl">3881.41744</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">            <span class="fl">935.19866</span>,<span class="fl">2103.97736</span>,<span class="fl">3181.75054</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">            <span class="fl">759.32467</span>,<span class="fl">1584.91057</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">            <span class="fl">723.30282</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="ot">NA</span>),<span class="dv">10</span>,<span class="dv">10</span>,<span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co"># the exposures (claims) used in the denominator</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">dnom &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">39161.</span>,<span class="fl">38672.4628</span>,<span class="fl">41801.048</span>,<span class="fl">42263.2794</span>,<span class="fl">41480.8768</span>,<span class="fl">40214.3872</span>,<span class="fl">43598.5056</span>,</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">       <span class="fl">42118.324</span>,<span class="fl">43479.4248</span>,<span class="fl">49492.4106</span>)</a>
<a class="sourceLine" id="cb2-18" data-line-number="18"></a>
<a class="sourceLine" id="cb2-19" data-line-number="19">size &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(B0)</a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co"># Identify model to be used</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#   Berquist for the Berquist-Sherman Incremental Severity</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#   CapeCod for the Cape Cod</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#   Hoerl for the Generalized Hoerl Curve Model with trend</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#   Wright for the Generalized Hoerl Curve with individual accident year levels</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#   Chain for the Chain Ladder model</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26">model &lt;-<span class="st"> "Berquist"</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">#model &lt;- "CapeCod"</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="co">#model &lt;- "Hoerl"</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co">#model &lt;- "Wright"</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="co">#model &lt;- "Chain"</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="co"># Toggle graphs off if desired</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32">graphs &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="co"># Toggle simulations off if desired</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35">simulation &lt;-<span class="st"> </span><span class="ot">TRUE</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Calculate incremental average matrix</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">A0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(B0[, <span class="dv">1</span>], (B0[, (<span class="dv">2</span><span class="op">:</span>size)] <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">*</span><span class="st"> </span>B0[, (<span class="dv">1</span><span class="op">:</span>(size <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))]) <span class="op">-</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">             </span>(B0[, (<span class="dv">1</span><span class="op">:</span>(size <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))] <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">*</span><span class="st"> </span>B0[, (<span class="dv">2</span><span class="op">:</span>size)]))</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co"># Generate a matrix to reflect exposure count in the variance structure</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">logd &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(dnom, size, size))</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co"># Set up matrix of rows and columns, makes later calculations simpler</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">rowNum &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/row.html">row</a></span>(A0)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">colNum &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/col.html">col</a></span>(A0)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#. upper_triangle_mask is a mask matrix of allowable data, upper triangular assuming same</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#' development increments as exposure increments</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#' msn is a mask matrix that picks off the first forecast diagonal</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#' msd is a mask matrix that picks off the to date diagonal</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">upper_triangle_mask &lt;-<span class="st"> </span>(size <span class="op">-</span><span class="st"> </span>rowNum) <span class="op">&gt;=</span><span class="st"> </span>colNum <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">msn &lt;-<span class="st"> </span>(size <span class="op">-</span><span class="st"> </span>rowNum) <span class="op">==</span><span class="st"> </span>colNum <span class="op">-</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19">msd &lt;-<span class="st"> </span>(size <span class="op">-</span><span class="st"> </span>rowNum) <span class="op">==</span><span class="st"> </span>colNum <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co"># Amount paid to date</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22">paid_to_date &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(B0 <span class="op">*</span><span class="st"> </span>msd, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="start-of-model-specific-code" class="section level2">
<h2 class="hasAnchor">
<a href="#start-of-model-specific-code" class="anchor"></a>START OF MODEL SPECIFIC CODE</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">  <span class="cf">if</span> (model <span class="op">==</span><span class="st"> "Berquist"</span>) {</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">    model_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/stochasticreserver/man/berquist.html">berquist</a></span>(B0, paid_to_date, upper_triangle_mask)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  } <span class="cf">else</span> <span class="cf">if</span> (model <span class="op">==</span><span class="st"> "CapeCod"</span>) {</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    model_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/stochasticreserver/man/capecod.html">capecod</a></span>(B0, paid_to_date, upper_triangle_mask)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  } <span class="cf">else</span> <span class="cf">if</span> (model <span class="op">==</span><span class="st"> "Hoerl"</span>) {</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    model_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/stochasticreserver/man/hoerl.html">hoerl</a></span>(B0, paid_to_date, upper_triangle_mask)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  } <span class="cf">else</span> <span class="cf">if</span> (model <span class="op">==</span><span class="st"> "Wright"</span>) {</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    model_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/stochasticreserver/man/wright.html">wright</a></span>(B0, paid_to_date, upper_triangle_mask)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  } <span class="cf">else</span> <span class="cf">if</span> (model <span class="op">==</span><span class="st"> "Chain"</span>) {</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    model_lst &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/stochasticreserver/man/chain.html">chain</a></span>(B0, paid_to_date, upper_triangle_mask)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">g_obj &lt;-<span class="st"> </span>model_lst<span class="op">$</span>g_obj</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">g_grad &lt;-<span class="st"> </span>model_lst<span class="op">$</span>g_grad</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">g_hess &lt;-<span class="st"> </span>model_lst<span class="op">$</span>g_hess</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">a0 &lt;-<span class="st"> </span>model_lst<span class="op">$</span>a0</a></code></pre></div>
</div>
<div id="negative-loglikelihood-function-to-be-minimized" class="section level2">
<h2 class="hasAnchor">
<a href="#negative-loglikelihood-function-to-be-minimized" class="anchor"></a>Negative Loglikelihood Function to be Minimized</h2>
<p>Note that the general form of the model has parameters in addition to those in the loss model, namely the power for the variance and the constant of proprtionality that varies by column. So if the original model has k parameters with size columns of data, the total objective function has k + size + 1 parameters</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">l.obj &lt;-<span class="st"> </span><span class="cf">function</span>(a, A) {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  npar &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(a) <span class="op">-</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  e &lt;-<span class="st"> </span><span class="kw">g_obj</span>(a[<span class="dv">1</span><span class="op">:</span>npar])</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  v &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(logd[, <span class="dv">1</span>], <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(a[npar <span class="op">+</span><span class="st"> </span><span class="dv">1</span>], size), <span class="st">"-"</span>)) <span class="op">*</span><span class="st"> </span>(e<span class="op">^</span><span class="dv">2</span>)<span class="op">^</span>a[npar <span class="op">+</span><span class="st"> </span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  t1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>v) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  t2 &lt;-<span class="st"> </span>(A <span class="op">-</span><span class="st"> </span>e) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>v)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(t1 <span class="op">+</span><span class="st"> </span>t2, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co"># Gradient of the objective function</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">l.grad &lt;-<span class="st"> </span><span class="cf">function</span>(a, A) {</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">  npar &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(a) <span class="op">-</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">  p &lt;-<span class="st"> </span>a[npar <span class="op">+</span><span class="st"> </span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">  Av &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(A, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">  e &lt;-<span class="st"> </span><span class="kw">g_obj</span>(a[<span class="dv">1</span><span class="op">:</span>npar])</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">  ev &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(e, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">  v &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(logd[, <span class="dv">1</span>], <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(a[npar <span class="op">+</span><span class="st"> </span><span class="dv">1</span>], size), <span class="st">"-"</span>)) <span class="op">*</span><span class="st"> </span>(e<span class="op">^</span><span class="dv">2</span>)<span class="op">^</span>p</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">  vv &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(v, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">  dt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="kw">g_grad</span>(a[<span class="dv">1</span><span class="op">:</span>npar]) <span class="op">*</span><span class="st"> </span>((p <span class="op">/</span><span class="st"> </span>ev) <span class="op">+</span><span class="st"> </span>(ev <span class="op">-</span><span class="st"> </span>Av) <span class="op">/</span><span class="st"> </span>vv <span class="op">-</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="st">                                      </span>(Av <span class="op">-</span><span class="st"> </span>ev)<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(vv <span class="op">*</span><span class="st"> </span>ev)),</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">               <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb5-21" data-line-number="21">               <span class="dt">dims =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-22" data-line-number="22">  yy &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(A <span class="op">-</span><span class="st"> </span>e) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>v</a>
<a class="sourceLine" id="cb5-23" data-line-number="23">  dk &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(yy <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">  dp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(yy <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(e <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(dt, dk, dp)</a>
<a class="sourceLine" id="cb5-26" data-line-number="26">}</a></code></pre></div>
</div>
<div id="hessian-of-the-objective-function" class="section level2">
<h2 class="hasAnchor">
<a href="#hessian-of-the-objective-function" class="anchor"></a>Hessian of the objective function</h2>
<ul>
<li>e is the expectated value matrix</li>
<li>v is the matrix of variances</li>
<li>A, e, v all have shape c(size, size)</li>
<li>The variables _v are copies of the originals to shape c(npar,size,size), paralleling the gradient of g.</li>
<li>The variables _m are copies of the originals to shape c(npar,npar,size,size), paralleling the hessian of g</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">l.hess &lt;-<span class="st"> </span><span class="cf">function</span>(a, A) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  npar &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(a) <span class="op">-</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  p &lt;-<span class="st"> </span>a[npar <span class="op">+</span><span class="st"> </span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  Av &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(A, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  Am &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(A, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  e &lt;-<span class="st"> </span><span class="kw">g_obj</span>(a[<span class="dv">1</span><span class="op">:</span>npar])</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  ev &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(e, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  em &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(e, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  v &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(logd[, <span class="dv">1</span>], <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(a[npar <span class="op">+</span><span class="st"> </span><span class="dv">1</span>], size), <span class="st">"-"</span>)) <span class="op">*</span><span class="st"> </span>(e <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span>p</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  vv &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(v, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  vm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(v, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">  g1 &lt;-<span class="st"> </span><span class="kw">g_grad</span>(a[<span class="dv">1</span><span class="op">:</span>npar])</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">  gg &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(g1, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(npar, size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">  gg &lt;-<span class="st"> </span>gg <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(gg, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb6-15" data-line-number="15">  gh &lt;-<span class="st"> </span><span class="kw">g_hess</span>(a[<span class="dv">1</span><span class="op">:</span>npar])</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">  dtt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">    gh <span class="op">*</span><span class="st"> </span>(p <span class="op">/</span><span class="st"> </span>em <span class="op">+</span><span class="st"> </span>(em <span class="op">-</span><span class="st"> </span>Am) <span class="op">/</span><span class="st"> </span>vm <span class="op">-</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span>(Am <span class="op">-</span><span class="st"> </span>em) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(vm <span class="op">*</span><span class="st"> </span>em)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="st">      </span>gg <span class="op">*</span><span class="st"> </span>(</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">        <span class="dv">1</span> <span class="op">/</span><span class="st"> </span>vm <span class="op">+</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span>(Am <span class="op">-</span><span class="st"> </span>em) <span class="op">/</span><span class="st"> </span>(vm <span class="op">*</span><span class="st"> </span>em) <span class="op">+</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(Am <span class="op">-</span><span class="st"> </span>em) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="st">          </span>(vm <span class="op">*</span><span class="st"> </span>em <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>p <span class="op">/</span><span class="st"> </span>em <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21">      ),</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">    <span class="dt">dims =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">  )</a>
<a class="sourceLine" id="cb6-25" data-line-number="25">  dkt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>((g1 <span class="op">*</span><span class="st"> </span>(Av <span class="op">-</span><span class="st"> </span>ev) <span class="op">+</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span>g1 <span class="op">*</span><span class="st"> </span>(Av <span class="op">-</span><span class="st"> </span>ev) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>ev) <span class="op">/</span><span class="st"> </span>vv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">  dtp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(g1 <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>ev <span class="op">+</span><span class="st"> </span>(</a>
<a class="sourceLine" id="cb6-27" data-line-number="27">    <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(ev <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>(Av <span class="op">-</span><span class="st"> </span>ev) <span class="op">+</span><span class="st"> </span>(p <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(ev <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(Av <span class="op">-</span><span class="st"> </span>ev) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>ev</a>
<a class="sourceLine" id="cb6-28" data-line-number="28">  ) <span class="op">/</span><span class="st"> </span>vv),</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">  <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">  dkk &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>((A <span class="op">-</span><span class="st"> </span>e) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>v), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-31" data-line-number="31">  dpk &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(e <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>(A <span class="op">-</span><span class="st"> </span>e) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>v), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-32" data-line-number="32">  dpp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(e <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(A <span class="op">-</span><span class="st"> </span>e) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>v), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-33" data-line-number="33">  m1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(dkt), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(dtp))</a>
<a class="sourceLine" id="cb6-34" data-line-number="34">  <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(dtt, <span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(m1)), <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(m1, <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(dkk, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb6-35" data-line-number="35">    dpk</a>
<a class="sourceLine" id="cb6-36" data-line-number="36">  )), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(dpk, dpp))))</a>
<a class="sourceLine" id="cb6-37" data-line-number="37">}</a></code></pre></div>
<p>End of funciton specificaitons now on to the minimization</p>
</div>
<div id="minimization" class="section level2">
<h2 class="hasAnchor">
<a href="#minimization" class="anchor"></a>Minimization</h2>
<div id="get-starting-values-for-kappa-and-p-parameters-default-10-and-1" class="section level3">
<h3 class="hasAnchor">
<a href="#get-starting-values-for-kappa-and-p-parameters-default-10-and-1" class="anchor"></a>Get starting values for kappa and p parameters, default 10 and 1</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">ttt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10</span>, <span class="dv">1</span>)</a></code></pre></div>
<p>For starting values use fitted objective function and assume variance for a cell is estimated by the square of the difference between actual and expected averages. Note since log(0) is -Inf we need to go through some machinations to prep the y values for the fit</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">E &lt;-<span class="st"> </span><span class="kw">g_obj</span>(a0)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">yyy &lt;-<span class="st"> </span>(A0 <span class="op">-</span><span class="st"> </span>E)<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">yyy &lt;-<span class="st"> </span>logd <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(((yyy <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>yyy) <span class="op">-</span><span class="st"> </span>(yyy <span class="op">==</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">sss &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(E<span class="op">^</span><span class="dv">2</span>)), <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(yyy)))</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">ttt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(sss<span class="op">$</span>y <span class="op">~</span><span class="st"> </span>sss<span class="op">$</span>x)))[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">a0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(a0, ttt)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1</span>) <span class="co"># to check reproducibility with original code</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">max &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">iter.max =</span> <span class="dv">10000</span>, <span class="dt">eval.max =</span> <span class="dv">10000</span>)</a></code></pre></div>
</div>
<div id="actual-minimization" class="section level3">
<h3 class="hasAnchor">
<a href="#actual-minimization" class="anchor"></a>Actual minimization</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">mle &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/nlminb.html">nlminb</a></span>(a0, l.obj, <span class="dt">gradient =</span> l.grad, <span class="dt">hessian =</span> l.hess, </a>
<a class="sourceLine" id="cb9-2" data-line-number="2">             <span class="dt">scale =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>((a0 <span class="op">*</span><span class="st"> </span>(a0 <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(a0 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>))))),</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">             <span class="dt">A =</span> A0, <span class="dt">control =</span> max)</a></code></pre></div>
</div>
<div id="model-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#model-statistics" class="anchor"></a>Model statistics</h3>
<ul>
<li>
<strong>mean</strong> and <strong>var</strong> are model fitted values</li>
<li>
<strong>stres</strong> is the standardized residuals</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">npar &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(a0) <span class="op">-</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">p &lt;-<span class="st"> </span>mle<span class="op">$</span>par[npar <span class="op">+</span><span class="st"> </span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">mean &lt;-<span class="st"> </span><span class="kw">g_obj</span>(mle<span class="op">$</span>par[<span class="dv">1</span><span class="op">:</span>npar])</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">var &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(logd[, <span class="dv">1</span>], <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(mle<span class="op">$</span>par[npar <span class="op">+</span><span class="st"> </span><span class="dv">1</span>], size), <span class="st">"-"</span>)) <span class="op">*</span><span class="st"> </span>(mean <span class="op">^</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">                                                                   </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span>p</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">stres &lt;-<span class="st"> </span>(A0 <span class="op">-</span><span class="st"> </span>mean) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(var)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">g1 &lt;-<span class="st"> </span><span class="kw">g_grad</span>(mle<span class="op">$</span>par[<span class="dv">1</span><span class="op">:</span>npar])</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">gg &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(g1, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(npar, size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">gg &lt;-<span class="st"> </span>gg <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(gg, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">meanv &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(mean, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">meanm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(mean, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">varm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(var, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a></code></pre></div>
</div>
<div id="masks-to-screen-out-na-entries-in-original-input-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#masks-to-screen-out-na-entries-in-original-input-matrix" class="anchor"></a>Masks to screen out NA entries in original input matrix</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">s &lt;-<span class="st"> </span><span class="dv">0</span> <span class="op">*</span><span class="st"> </span>A0</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">sv &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(s, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">sm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(s, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, npar, npar)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a></code></pre></div>
</div>
<div id="calculate-the-information-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-the-information-matrix" class="anchor"></a>Calculate the information matrix</h3>
<ul>
<li>Using second derivatives of the log likelihood function Second with respect to theta parameters</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">tt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(sm <span class="op">+</span><span class="st"> </span>gg <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>varm <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>p <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(meanm <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)), <span class="dt">dims =</span> <span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Second with respect to theta and kappa</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">kt &lt;-<span class="st"> </span>p <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(sv <span class="op">+</span><span class="st"> </span>g1 <span class="op">/</span><span class="st"> </span>meanv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Second with respect to p and theta</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">tp &lt;-<span class="st"> </span>p <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(sv <span class="op">+</span><span class="st"> </span>g1 <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(meanv <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>meanv, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Second with respect to kappa</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">kk &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>s, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Second with respect to p and kappa</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">pk &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(s <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(mean <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Second with respect to p</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">pp &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(s <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(mean <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="create-information-matrix-in-blocks" class="section level3">
<h3 class="hasAnchor">
<a href="#create-information-matrix-in-blocks" class="anchor"></a>Create information matrix in blocks</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">m1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(kt), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(tp))</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">inf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(tt, <span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(m1)), <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(m1, <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(kk, pk), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(pk, pp))))</a></code></pre></div>
</div>
</div>
<div id="variance-covariance-matrix-for-parameters-inverse-of-information-matrix" class="section level1">
<h1 class="hasAnchor">
<a href="#variance-covariance-matrix-for-parameters-inverse-of-information-matrix" class="anchor"></a>Variance-covariance matrix for parameters, inverse of information matrix</h1>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">vcov &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/solve.html">solve</a></span>(inf)</a></code></pre></div>
<div id="simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h3>
<p>Initialize simulation array to keep simulation results</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">11</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">smn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">11</span>)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">spm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, npar <span class="op">+</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<p>Simulation for distribution of future amounts</p>
<p>Want 10,000 simulations, but exceeds R capacity, so do in batches of 5,000</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">nsim &lt;-<span class="st"> </span><span class="dv">5000</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">smsk &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(upper_triangle_mask), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, nsim)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">smsn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(msn), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(size, size, nsim)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb21-4" data-line-number="4"></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="cf">if</span> (simulation) {</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) {</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">    <span class="co"># Randomly generate parameters from multivariate normal</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8">    spar &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html">rmvnorm</a></span>(nsim, mle<span class="op">$</span>par, vcov)</a>
<a class="sourceLine" id="cb21-9" data-line-number="9"></a>
<a class="sourceLine" id="cb21-10" data-line-number="10">    <span class="co"># Arrays to calculate simulated means</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11">    esim &lt;-<span class="st"> </span><span class="kw">g_obj</span>(spar)</a>
<a class="sourceLine" id="cb21-12" data-line-number="12"></a>
<a class="sourceLine" id="cb21-13" data-line-number="13">    <span class="co"># Arrays to calculate simulated variances</span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14">    ksim &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/aperm.html">aperm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(</a>
<a class="sourceLine" id="cb21-15" data-line-number="15">      spar[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(npar <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)], <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(nsim, size)</a>
<a class="sourceLine" id="cb21-16" data-line-number="16">    ), <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(dnom), <span class="st">"-"</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb21-17" data-line-number="17">    psim &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(spar[, npar <span class="op">+</span><span class="st"> </span><span class="dv">2</span>], <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(nsim, size, size))</a>
<a class="sourceLine" id="cb21-18" data-line-number="18">    vsim &lt;-<span class="st"> </span>ksim <span class="op">*</span><span class="st"> </span>(esim <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">^</span><span class="st"> </span>psim</a>
<a class="sourceLine" id="cb21-19" data-line-number="19"></a>
<a class="sourceLine" id="cb21-20" data-line-number="20">    <span class="co"># Randomly simulate future averages</span></a>
<a class="sourceLine" id="cb21-21" data-line-number="21">    temp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(nsim <span class="op">*</span><span class="st"> </span>size <span class="op">*</span><span class="st"> </span>size, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(esim), <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(vsim))), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(nsim, size, size))</a>
<a class="sourceLine" id="cb21-22" data-line-number="22"></a>
<a class="sourceLine" id="cb21-23" data-line-number="23">    <span class="co"># Combine to total by exposure period and in aggregate</span></a>
<a class="sourceLine" id="cb21-24" data-line-number="24">    <span class="co"># notice separate array with name ending in "n" to capture</span></a>
<a class="sourceLine" id="cb21-25" data-line-number="25">    <span class="co"># forecast for next accounting period</span></a>
<a class="sourceLine" id="cb21-26" data-line-number="26">    sdnm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(dnom, size, nsim))</a>
<a class="sourceLine" id="cb21-27" data-line-number="27">    fore &lt;-<span class="st"> </span>sdnm <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(temp <span class="op">*</span><span class="st"> </span><span class="op">!</span>smsk, <span class="dt">dims =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb21-28" data-line-number="28">    forn &lt;-<span class="st"> </span>sdnm <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(temp <span class="op">*</span><span class="st"> </span>smsn, <span class="dt">dims =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb21-29" data-line-number="29"></a>
<a class="sourceLine" id="cb21-30" data-line-number="30">    <span class="co"># Cumulate and return for another 5,000</span></a>
<a class="sourceLine" id="cb21-31" data-line-number="31">    sim &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(sim, <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(fore, <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(fore)))</a>
<a class="sourceLine" id="cb21-32" data-line-number="32">    smn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(smn, <span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(forn, <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(forn)))</a>
<a class="sourceLine" id="cb21-33" data-line-number="33">    spm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(spm, spar)</a>
<a class="sourceLine" id="cb21-34" data-line-number="34">  }</a>
<a class="sourceLine" id="cb21-35" data-line-number="35">}</a></code></pre></div>
</div>
<div id="print-results" class="section level2">
<h2 class="hasAnchor">
<a href="#print-results" class="anchor"></a>Print Results</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">model</a></code></pre></div>
<pre><code>## [1] "Berquist"</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/stochasticreserver/man/model_description.html">model_description</a></span>(model)</a></code></pre></div>
<pre><code>## [1] "Berquist-Sherman Incremental Severity"</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(sim)</a></code></pre></div>
<pre><code>##        V1          V2                 V3                 V4          
##  Min.   :0   Min.   :-1452523   Min.   :-1460032   Min.   :-1416929  
##  1st Qu.:0   1st Qu.:  302558   1st Qu.:  811550   1st Qu.: 2807320  
##  Median :0   Median :  597817   Median : 1228080   Median : 3544006  
##  Mean   :0   Mean   :  642440   Mean   : 1252318   Mean   : 3558347  
##  3rd Qu.:0   3rd Qu.:  932306   3rd Qu.: 1673686   3rd Qu.: 4290686  
##  Max.   :0   Max.   : 3508046   Max.   : 4460241   Max.   : 8808302  
##        V5                 V6                 V7          
##  Min.   :   -6553   Min.   : 5560629   Min.   :20506185  
##  1st Qu.: 6227569   1st Qu.:15141382   1st Qu.:37021474  
##  Median : 7336299   Median :17015966   Median :40212065  
##  Mean   : 7343317   Mean   :17027739   Mean   :40274082  
##  3rd Qu.: 8459679   3rd Qu.:18881648   3rd Qu.:43484551  
##  Max.   :15788019   Max.   :29283048   Max.   :63449354  
##        V8                  V9                 V10           
##  Min.   : 42237266   Min.   : 84207233   Min.   :155320285  
##  1st Qu.: 69227330   1st Qu.:119093974   1st Qu.:198804197  
##  Median : 74008098   Median :126196817   Median :209482103  
##  Mean   : 74154814   Mean   :126342190   Mean   :209675354  
##  3rd Qu.: 78916652   3rd Qu.:133428500   3rd Qu.:220366856  
##  Max.   :110991079   Max.   :173619116   Max.   :279848807  
##       V11           
##  Min.   :366516154  
##  1st Qu.:460324346  
##  Median :479599631  
##  Mean   :480270601  
##  3rd Qu.:499535658  
##  Max.   :598174718</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(smn)</a></code></pre></div>
<pre><code>##        V1          V2                 V3                 V4          
##  Min.   :0   Min.   :-1452523   Min.   :-1138446   Min.   :-1476281  
##  1st Qu.:0   1st Qu.:  302558   1st Qu.:  272247   1st Qu.: 1626501  
##  Median :0   Median :  597817   Median :  505270   Median : 2200960  
##  Mean   :0   Mean   :  642440   Mean   :  527492   Mean   : 2230028  
##  3rd Qu.:0   3rd Qu.:  932306   3rd Qu.:  758791   3rd Qu.: 2800206  
##  Max.   :0   Max.   : 3508046   Max.   : 2627158   Max.   : 6670925  
##        V5                 V6                 V7          
##  Min.   :-1172470   Min.   : 1270164   Min.   : 5239797  
##  1st Qu.: 2880155   1st Qu.: 8086341   1st Qu.:18510808  
##  Median : 3663228   Median : 9515524   Median :20882468  
##  Mean   : 3691096   Mean   : 9561369   Mean   :20957144  
##  3rd Qu.: 4467433   3rd Qu.:11003597   3rd Qu.:23334596  
##  Max.   : 9452336   Max.   :19788052   Max.   :38041131  
##        V8                 V9                V10           
##  Min.   :11507452   Min.   :23972497   Min.   : 23306626  
##  1st Qu.:30127968   1st Qu.:42126743   1st Qu.: 54269334  
##  Median :33338663   Median :46211701   Median : 59039646  
##  Mean   :33428879   Mean   :46263910   Mean   : 59065905  
##  3rd Qu.:36694937   3rd Qu.:50318506   3rd Qu.: 63803067  
##  Max.   :56230971   Max.   :74988812   Max.   :103912858  
##       V11           
##  Min.   :118324354  
##  1st Qu.:167789490  
##  Median :176256113  
##  Mean   :176368264  
##  3rd Qu.:184790407  
##  Max.   :231225457</code></pre>
</div>
<div id="scatter-plots-of-residuals-distribution-of-forecasts" class="section level2">
<h2 class="hasAnchor">
<a href="#scatter-plots-of-residuals-distribution-of-forecasts" class="anchor"></a>Scatter plots of residuals &amp; Distribution of Forecasts</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="cf">if</span> (graphs) {</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">  <span class="co">#x11(title &lt;- model_description(model))</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"></a>
<a class="sourceLine" id="cb30-4" data-line-number="4">  <span class="co"># Prep data for lines for averages in scatter plots of standardized residuals</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5">  ttt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(rowNum <span class="op">+</span><span class="st"> </span>colNum <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(stres)), </a>
<a class="sourceLine" id="cb30-6" data-line-number="6">              <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(stres)), <span class="dv">2</span>, <span class="dv">19</span>))</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">  sss &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>((<span class="dv">1</span><span class="op">:</span><span class="dv">19</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">19</span>, <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(stres)))))</a>
<a class="sourceLine" id="cb30-8" data-line-number="8"></a>
<a class="sourceLine" id="cb30-9" data-line-number="9">  <span class="co"># Plotting</span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10">  <span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb30-11" data-line-number="11">  <span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(</a>
<a class="sourceLine" id="cb30-12" data-line-number="12">    <span class="kw"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(rowNum <span class="op">+</span><span class="st"> </span>colNum <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(stres))),</a>
<a class="sourceLine" id="cb30-13" data-line-number="13">    <span class="dt">main =</span> <span class="st">"Standardized Residuals by CY"</span>,</a>
<a class="sourceLine" id="cb30-14" data-line-number="14">    <span class="dt">xlab =</span> <span class="st">"CY"</span>,</a>
<a class="sourceLine" id="cb30-15" data-line-number="15">    <span class="dt">ylab =</span> <span class="st">"Standardized Residual"</span>,</a>
<a class="sourceLine" id="cb30-16" data-line-number="16">    <span class="dt">pch =</span> <span class="dv">18</span></a>
<a class="sourceLine" id="cb30-17" data-line-number="17">  )</a>
<a class="sourceLine" id="cb30-18" data-line-number="18">  <span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb30-19" data-line-number="19">    <span class="dt">x =</span> (<span class="dv">1</span><span class="op">:</span><span class="dv">19</span>),</a>
<a class="sourceLine" id="cb30-20" data-line-number="20">    <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(ttt[, <span class="dv">2</span>, ] <span class="op">*</span></a>
<a class="sourceLine" id="cb30-21" data-line-number="21"><span class="st">                  </span>(ttt[, <span class="dv">1</span>, ] <span class="op">==</span><span class="st"> </span>sss), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span></a>
<a class="sourceLine" id="cb30-22" data-line-number="22"><span class="st">      </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>((ttt[, <span class="dv">1</span>, ] <span class="op">==</span><span class="st"> </span>sss) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-23" data-line-number="23"><span class="st">                </span><span class="dv">0</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb30-24" data-line-number="24"><span class="st">                </span>ttt[, <span class="dv">2</span>, ], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb30-25" data-line-number="25">  )), <span class="dt">col =</span> <span class="st">"red"</span>)</a>
<a class="sourceLine" id="cb30-26" data-line-number="26">  <span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(</a>
<a class="sourceLine" id="cb30-27" data-line-number="27">    <span class="kw"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(colNum), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(stres))),</a>
<a class="sourceLine" id="cb30-28" data-line-number="28">    <span class="dt">main =</span> <span class="st">"Standardized Residuals by Lag"</span>,</a>
<a class="sourceLine" id="cb30-29" data-line-number="29">    <span class="dt">xlab =</span> <span class="st">"Lag"</span>,</a>
<a class="sourceLine" id="cb30-30" data-line-number="30">    <span class="dt">ylab =</span> <span class="st">"Standardized Residual"</span>,</a>
<a class="sourceLine" id="cb30-31" data-line-number="31">    <span class="dt">pch =</span> <span class="dv">18</span></a>
<a class="sourceLine" id="cb30-32" data-line-number="32">  )</a>
<a class="sourceLine" id="cb30-33" data-line-number="33">  <span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb30-34" data-line-number="34">    <span class="dt">x =</span> colNum[<span class="dv">1</span>, ],</a>
<a class="sourceLine" id="cb30-35" data-line-number="35">    <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(stres, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span></a>
<a class="sourceLine" id="cb30-36" data-line-number="36"><span class="st">      </span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">*</span><span class="st"> </span>stres, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb30-37" data-line-number="37">  )), <span class="dt">col =</span> <span class="st">"red"</span>)</a>
<a class="sourceLine" id="cb30-38" data-line-number="38">  <span class="kw"><a href="https://rdrr.io/r/stats/qqnorm.html">qqnorm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(stres))</a>
<a class="sourceLine" id="cb30-39" data-line-number="39">  <span class="kw"><a href="https://rdrr.io/r/stats/qqnorm.html">qqline</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(stres))</a>
<a class="sourceLine" id="cb30-40" data-line-number="40">  <span class="cf">if</span> (simulation) {</a>
<a class="sourceLine" id="cb30-41" data-line-number="41">    proc &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">x =</span> (<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(sim[, <span class="dv">11</span>]))<span class="op">$</span>x,</a>
<a class="sourceLine" id="cb30-42" data-line-number="42">                <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>((<span class="kw"><a href="https://rdrr.io/r/stats/density.html">density</a></span>(sim[, <span class="dv">11</span>]))<span class="op">$</span>x,</a>
<a class="sourceLine" id="cb30-43" data-line-number="43">                          <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb30-44" data-line-number="44">                            dnom</a>
<a class="sourceLine" id="cb30-45" data-line-number="45">                          ), size, size) <span class="op">*</span><span class="st"> </span>mean <span class="op">*</span><span class="st"> </span><span class="op">!</span>upper_triangle_mask),</a>
<a class="sourceLine" id="cb30-46" data-line-number="46">                          <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(</a>
<a class="sourceLine" id="cb30-47" data-line-number="47">                            <span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(dnom), size, size) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>var <span class="op">*</span><span class="st"> </span><span class="op">!</span>upper_triangle_mask</a>
<a class="sourceLine" id="cb30-48" data-line-number="48">                          ))))</a>
<a class="sourceLine" id="cb30-49" data-line-number="49">    MASS<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/MASS/man/truehist.html">truehist</a></span>(sim[, <span class="dv">11</span>],</a>
<a class="sourceLine" id="cb30-50" data-line-number="50">             <span class="dt">ymax =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(proc<span class="op">$</span>y),</a>
<a class="sourceLine" id="cb30-51" data-line-number="51">             <span class="dt">main =</span> <span class="st">"All Years Combined Future Amounts"</span>,</a>
<a class="sourceLine" id="cb30-52" data-line-number="52">             <span class="dt">xlab =</span> <span class="st">"Aggregate"</span>)</a>
<a class="sourceLine" id="cb30-53" data-line-number="53">    <span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(proc)</a>
<a class="sourceLine" id="cb30-54" data-line-number="54">  }</a>
<a class="sourceLine" id="cb30-55" data-line-number="55">}</a></code></pre></div>
<p><img src="stochastic_reserving_files/figure-html/plots-1.png" width="700"> ## Summary From Simulation</p>
<p>Summary of mean, standard deviation, and 90% confidence interval from simulation, similar for one-period forecast</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">sumr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">sumn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">11</span>) {</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">  sumr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(sumr, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(sim[, i]), <span class="kw"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(sim[, i]), <span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(sim[, i], <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">05</span>, <span class="fl">.95</span>))))</a>
<a class="sourceLine" id="cb31-6" data-line-number="6">  sumn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(sumn, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(smn[, i]), <span class="kw"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(smn[, i]), <span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(smn[, i], <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">05</span>, <span class="fl">.95</span>))))</a>
<a class="sourceLine" id="cb31-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb31-8" data-line-number="8">sumr</a></code></pre></div>
<pre><code>##                                        5%       95%
##  [1,]         0.0        0.0         0.00         0
##  [2,]    642440.5   481028.8    -44194.36   1501201
##  [3,]   1252318.1   648086.8    234536.28   2350542
##  [4,]   3558346.6  1140237.1   1736139.47   5459264
##  [5,]   7343316.8  1685230.7   4618772.27  10135134
##  [6,]  17027739.1  2812746.4  12455686.23  21698143
##  [7,]  40274081.9  4840499.9  32377990.92  48358166
##  [8,]  74154813.9  7300843.4  62309918.99  86306505
##  [9,] 126342190.5 10639635.7 109032027.02 144116409
## [10,] 209675353.5 15905776.4 183850667.27 236026995
## [11,] 480270600.9 29296749.7 432905077.06 529557186</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">sumn</a></code></pre></div>
<pre><code>##                                        5%       95%
##  [1,]         0.0        0.0         0.00         0
##  [2,]    642440.5   481028.8    -44194.36   1501201
##  [3,]    527492.0   376363.7    -37645.58   1173939
##  [4,]   2230028.1   900647.6    790310.82   3758650
##  [5,]   3691095.9  1201650.8   1761276.09   5701639
##  [6,]   9561369.2  2183081.0   6055215.06  13228795
##  [7,]  20957144.4  3610684.4  15092490.22  26953460
##  [8,]  33428879.0  4931632.4  25433851.64  41583251
##  [9,]  46263909.9  6136563.8  36357479.01  56377102
## [10,]  59065904.7  7160890.5  47441520.52  70937231
## [11,] 176368263.7 12708050.9 155788022.10 197482374</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#initialize-triangle">Initialize Triangle</a></li>
      <li><a href="#start-of-model-specific-code">START OF MODEL SPECIFIC CODE</a></li>
      <li><a href="#negative-loglikelihood-function-to-be-minimized">Negative Loglikelihood Function to be Minimized</a></li>
      <li><a href="#hessian-of-the-objective-function">Hessian of the objective function</a></li>
      <li><a href="#minimization">Minimization</a></li>
      <li>
<a href="#variance-covariance-matrix-for-parameters-inverse-of-information-matrix">Variance-covariance matrix for parameters, inverse of information matrix</a><ul class="nav nav-pills nav-stacked">
<li><a href="#print-results">Print Results</a></li>
      <li><a href="#scatter-plots-of-residuals-distribution-of-forecasts">Scatter plots of residuals &amp; Distribution of Forecasts</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Roger Hayne, R. Mark Sharp.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
